# Session: Bug Fixes #135 & #137

**Date:** 2026-02-27T01:23:00Z  
**Spawn:** Fenster (Core Dev)  
**Request:** Brady asked to fix #135 (Windows EPERM) and #137 (--version wrong)  
**Branch:** squad/135-137-cli-fixes  
**PR:** #149 opened  

## What Happened

Fenster fixed two critical CLI bugs in a single PR against dev:

### Bug #135: Windows EPERM on migrate-directory
- **Problem:** Users with VS Code open couldn't run `migrate-directory` because VS Code file handles blocked rename operations.
- **Solution:** `safeRename()` utility wraps `fs.renameSync()` with fallback to `fs.cpSync()` + `fs.rmSync()` on EPERM/EACCES.
- **Scope:** Localized to migrate-directory block.
- **Trade-off:** Copy+delete is slower than atomic rename but only triggers on error.

### Bug #137: --version shows wrong version
- **Problem:** `--version` showed only the npx CLI version, not what's installed in the repo. Confusing during upgrades.
- **Solution:** Dual-version display:
  - `Package: X.X.X` — npx version being run
  - `Installed: X.X.X` — from squad.agent.md HTML comment
  - Shows "not installed" if squad.agent.md missing
- **Outcome:** Users can now see both versions and understand what they're working with.

## Results
- **Tests:** 95/95 passing ✓
- **Files changed:** index.js (safeRename + version logic)
- **Status:** Ready for code review and merge

## Decisions Made
1. safeRename scoped to migration (not a global utility) — minimize scope creep
2. Dual version in --version output — solves both npx and repo version confusion
3. Graceful "not installed" message — handles missing squad.agent.md edge case

## Next
- PR #149 review → dev branch → release in next version
