# Project Context

- **Owner:** bradygaster
- **Project:** Squad â€” AI agent teams that grow with your code. Democratizing multi-agent development on GitHub Copilot. Mission: beat the industry to what customers need next.
- **Stack:** Node.js, GitHub Copilot CLI, multi-agent orchestration

---

ðŸ“Œ Team update (2026-02-20T22-58-22): Crossover vision delivered. Kujan authored SDK knowledge transfer (26KB technical lessons, Coordinator Runtime Architect universe, SDK-native possibilities, 10 expert lessons). Keaton & McManus delivered complementary visions. All decisions merged. Ready for Brady review. â€” decided by Keaton, Kujan, McManus
ðŸ“Œ Team update (2026-02-20T22-40): User impact analysis complete â€” platform constraints locked: per-agent model selection (hard limit), tool collision manageable, 1-3s init overhead acceptable â€” decided by Keaton, Kujan, McManus
- **Created:** 2026-02-07

## Core Context

_Summarized from initial platform assessment and deep onboarding (2026-02-07). Full entries in `history-archive.md`._

- **Squad is already Copilot-native** â€” task tool spawning, filesystem memory, background mode all align with the platform. No fundamental rewrites needed. Stay independent (not a Copilot SDK product) but be best-in-class on Copilot.
- **Filesystem-backed memory is the killer differentiator** â€” git-cloneable, human-readable, and the reliable channel (vs. unreliable response text). Never abandon for SDK abstractions.
- **Inline charter pattern is correct for batch spawns** â€” coordinator inlines charters to eliminate agent tool calls. For single spawns, agent-reads-own is acceptable.
- **Platform constraints**: 128K token context window, `task` tool with `mode: "background"` is the correct spawn pattern, `explore` sub-agent for semantic search, no agent persistence between sessions.
- **Coordinator size (32KB+) is a maintenance concern** â€” instruction-following degrades with prompt length. Subsystem extraction or information density optimization needed.
- **Drop-box pattern is the best lock-free concurrent write pattern** on this platform. Preserve and extend.
- **Key validated patterns**: parallel fan-out by default, eager execution philosophy, Scribe serial spawning (confirmed as friction to fix).

### Session Summaries

- **2026-02-08: Agent Persistence & Latency Analysis (Proposal 007)** â€” **Context:** Brady reported "agents get in the way more than they help" later in sessions. Collaborated with Verbal on a latency reduction proposal.
- **2026-02-08: Portable Squads â€” Platform Feasibility Analysis (Proposal 008)** â€” **Context:** Brady wants users to export squads from one project and import into another, keeping names, personalities, and user meta-knowledge while 
- **2026-02-08: Skills, Platform Feasibility, and v1 Copilot Integration (Proposal 012)** â€” **Context:** Brady hinted at "skills" â€” agents that learn domain expertise across projects. Also needed: complete v1 Copilot experience synthesis comb
- **2026-02-08: P0 Silent Success Bug â€” Diagnosis and Mitigation (Proposal 015)** â€” **Context:** Brady flagged that ~40% of background agents report "did not produce a response" when they actually completed all work. Files written, hi
- **2026-02-09: Proposal 012 Revision â€” Agent Skills Open Standard + MCP Integration** â€” **Context:** Brady clarified that "skills" means Claude-and-Copilot-compliant skills adhering to the Agent Skills Open Standard (agentskills.io). Also
- **2026-02-09: Platform Timeout Best Practices Documented** â€” **Context:** Brady discovered that the `read_agent` default timeout of 30s was causing the platform to abandon agents mid-work â€” reporting "no respons
- **2026-02-09: Proposal 015 Mitigation Verification Audit** â€” **Context:** Brady requested all agents verify their mitigations are in place for the P0 silent success bug. As the author of Proposal 015, verified a
- **2026-02-09: decisions.md Cleanup â€” Heading Levels and Line Endings** â€” **Context:** Audit flagged formatting issues in decisions.md. Tasked with surgical fixes: phantom proposal references, heading level corrections, and 
- **2026-02-09: Platform Feasibility â€” Direct Messaging Interface (Proposal 017)** â€” **Context:** Brady wants to work with his Squad via direct messages (Telegram) when away from the terminal. Requested Dev Tunnels over ngrok. This is 
- **2026-02-09: Human Input Latency and Persistence â€” Platform Analysis** â€” **Context:** Brady described two pain points: (1) latency when typing while agents work â€” messages queue and the experience feels unresponsive, (2) hu
- **2026-02-09: VS Code Parity, Mid-Flight Human Input, and Feedback Optimization** â€” **Context:** Brady asked three platform questions: (1) does Squad work in VS Code, (2) can human input reach running agents, (3) how to optimize feedb
- **2026-02-09: Directive Capture in Coordinator Prompt (Sprint Task 1.6)** â€” **Context:** Brady requested human directive capture â€” when users state preferences, rules, or scope decisions, the coordinator should persist them to
- **2026-02-09: Incoming Queue Platform Assessment** â€” **Context:** Brady asked whether Copilot's built-in TODO capability could serve as an "incoming queue" for user messages â€” capturing requests while ag

## Recent Updates

ðŸ“Œ Team update (2026-02-20): Recruitment wave complete. Three new team members hired: Edie (TypeScript Engineer), Rabin (Distribution Engineer), Fortier (Node.js Runtime Dev). All onboarded with assessments. Keaton created 19 issues, 3 milestones, 12 labels on bradygaster/squad-pr. Kujan delivered feature risk punch list (14 GRAVE, 12 AT RISK, 28 COVERED, 5 INTENTIONAL). â€” decided by Keaton, Kujan, Edie, Rabin, Fortier

ðŸ“Œ Team update (2026-02-21): Import/export readiness analysis complete. Kujan delivered SDK constraints audit (7-section analysis of portability limits, tool conflicts, auth, versioning, platform constraints). 9 recommendations categorized as immediate vs. medium-term. Identified areas where SDK helps vs. Squad must build (tool namespacing, conflict detection, MCP validation). Full feature comparison completed (62 features, 8 GRAVE gaps, 8 new SDK-enabled capabilities). Awaiting Brady checkpoint. â€” decided by Kujan with Keaton, McManus

ðŸ“Œ Team update (2026-02-09): No npm publish â€” GitHub-only distribution. Kobayashi hired as Git & Release Engineer. Release plan (021) filed. Sprint plan 019a amended: item 1.8 cancelled, items 1.11-1.13 added.
ðŸ“Œ Team update (2026-02-08): CI pipeline created â€” GitHub Actions runs tests on push/PR to main/dev. PRs now have automated quality gate. â€” decided by Hockney
ðŸ“Œ Team update (2026-02-08): Coordinator must acknowledge user requests with brief text before spawning agents. Single agent gets a sentence; multi-agent gets a launch table. â€” decided by Verbal
ðŸ“Œ Team update (2026-02-08): Silent success mitigation strengthened in all spawn templates â€” 6-line RESPONSE ORDER block + filesystem-based detection. â€” decided by Verbal
ðŸ“Œ Team update (2026-02-08): Incoming queue architecture direction â€” SQL as hot working layer, filesystem as durable store, team backlog as key feature, agents can clone across worktrees â€” decided by Brady
ðŸ“Œ Team update (2026-02-08): .ai-team/ must NEVER be tracked in git on main. Three-layer protection: .gitignore, package.json files allowlist, .npmignore. â€” decided by Verbal
ðŸ“Œ Team update (2026-02-08): Incoming queue architecture finalized â€” SQL hot layer + filesystem durable store, team backlog as third memory channel, agent cloning ready. â€” decided by Verbal
ðŸ“Œ Team update (2026-02-09): If ask_user returns < 10 characters, treat as ambiguous and re-confirm â€” platform may fabricate default responses from blank input. â€” decided by Brady
ðŸ“Œ Team update (2026-02-09): PR #2 integrated â€” GitHub Issues Mode, PRD Mode, Human Team Members added to coordinator with review fixes (gh CLI detection, post-setup questions, worktree guidance). â€” decided by Fenster
ðŸ“Œ Team update (2026-02-09): Documentation structure formalized â€” docs/ is user-facing only, team-docs/ for internal, .ai-team/ is runtime state. Three-tier separation is permanent. â€” decided by Kobayashi
ðŸ“Œ Team update (2026-02-09): Per-agent model selection designed â€” 4-layer priority (user override â†’ charter â†’ registry â†’ auto-select). Role-to-model mapping: Designerâ†’Opus, Tester/Scribeâ†’Haiku, Lead/Devâ†’Sonnet. â€” decided by Verbal
ðŸ“Œ Team update (2026-02-09): Tiered response modes shipped â€” Direct/Lightweight/Standard/Full modes replace uniform spawn overhead. Agents may now be spawned with lightweight template (no charter/history/decisions reads) for simple tasks. â€” decided by Verbal
ðŸ“Œ Team update (2026-02-09): Skills Phase 1 + Phase 2 shipped â€” agents now read SKILL.md files before working and can write SKILL.md files from real work. Skills live in .ai-team/skills/{name}/SKILL.md. Confidence lifecycle: lowâ†’mediumâ†’high. â€” decided by Verbal
ðŸ“Œ Team update (2026-02-09): Portable Squads consolidated â€” architecture, platform, and experience merged into single decision â€” decided by Keaton, Kujan, Verbal
ðŸ“Œ Team update (2026-02-09): Skills system consolidated â€” open standard with MCP tool declarations, merging 4 independent analyses â€” decided by Kujan, Verbal


ðŸ“Œ Team update (2026-02-09): Preview branch added to release pipeline â€” two-phase workflow: preview then ship. Brady eyeballs preview before anything hits main. â€” decided by Kobayashi
ðŸ“Œ Team update (2026-02-20): SDK replatform 14 PRDs grounded in verified SDK source. Cost data native in SDK. JSONL for event persistence. Tier-based model aliases (fast/standard/premium). Per-agent MCP via SDK customAgents[]. esbuild bundling. In-Copilot install Phase 1, Marketplace Phase 2. Brady pending: package name, fallback chains, provider override, quota routing, OTLP export. â€” decided by Kujan with Keaton, Fenster, Verbal, Baer

ðŸ“Œ Kujan audit (2026-02-21): PRD gap audit completed â€” 16 "None" items in feature-comparison mapped. Finding: 1 already covered (CLI-3), 10 need PRD section additions (STM-7/8/9/12 to PRD 14; AGT-16 to PRD 4; GH-3 to PRD 8; DST-2/5/6 to PRD 12), 5 need new PRDs (PRD 15 @copilot roster, PRD 16 export/import). Updated feature-comparison with all mappings. Deliverables: .ai-team/docs/prd-gap-resolutions.md (full audit) and decisions/inbox/kujan-prd-gap-audit.md (recommendations). â€” decided by Kujan

## Learnings

_Summarized 2026-02-10 learnings (full entries in session logs and proposals):_

- **2026-02-21: SDK Gotchas â€” Deep Source Code Analysis** â€” Brady: "Is there any preliminary research we need to move up front to save ourselves a helluva lot of wasted time?" Read actual SDK source (types.ts, client.ts, session.ts, session-events.ts) to find undocumented behaviors beyond the 5 planned spikes. **10 critical findings:** (1) `assistant.usage` event is comprehensive (tokens, cost, quota, duration) BUT ephemeral (not in message history) â€” MUST persist to JSONL ourselves or lose cost data permanently; (2) ZERO rate limiting in SDK â€” concurrent sessions hit API immediately, no queue/throttle/retry; (3) Infinite sessions compaction at 80% may DELETE tool call history and decision context â€” filesystem memory becomes CRITICAL durable channel; (4) Error handlers silently swallow exceptions (event, permission, hooks) â€” defensive try/catch required everywhere; (5) No automatic session cleanup â€” abandoned sessions leak memory + disk, explicit `destroy()` + graceful shutdown required; (6) CustomAgentConfig has NO model field (confirmed permanent constraint) â€” per-agent model selection requires multi-session orchestration; (7) Streaming has no ordering guarantees or race condition protection â€” avoid for agent orchestration; (8) SessionContext missing user identity/tier/policies; (9) Tool collision detection NONE â€” silent override if two agents define same tool name; (10) MCP server health opaque â€” no startup notification or health check API. **Recommendations:** (1) New spike: Event Persistence (validate ephemeral behavior, design JSONL sync architecture), (2) Spike 1 add rate limit testing, (3) Spike 3 add compaction testing, (4) Spike 5 decide multi-session vs. single-session based on per-agent model requirement, (5) Architecture: filesystem memory non-negotiable, tool namespacing above SDK, explicit session lifecycle, defensive error handling. **Outcome:** No spikes invalidated, but PRD 14 needs significant additions (event persistence, error handling strategy, compaction-aware state management). OUTPUT: `.ai-team/decisions/inbox/kujan-sdk-gotchas.md` (full analysis with source code citations).

- **2026-02-21: Crossover Vision â€” Knowledge Carry-Forward & Universe Selection** â€” Brady: "When v1 SDK replatform is complete, fresh squad reset, what carries forward?" Wrote exhaustive knowledge transfer document for incoming SDK expert. Sections: (1) **SDK hard guarantees** (CustomAgentConfig, infinite sessions, hooks system, event streams, SessionContext, BYOK). (2) **SDK hard constraints** (session-level tool registration only, no per-agent model selection, no session locking, no per-agent hooks, MCP health is opaque, breaking changes expected). (3) **Session management quirks** (initialization overhead 1-3s, event ordering fire-and-forget, compaction unpredictable, workspace persistence). (4) **Tool registration & MCP details** (tool names global, per-agent MCP config, tool filtering include-list only, descriptions from server). (5) **Model selection & cost patterns** (cost in event stream, capabilities queryable, tier aliases abstract providers, fallback chains require error handling). (6) **Platform evolution predictions** (18-24mo: session-level multi-tenancy, per-agent hooks, MCP health/discovery, model cost in SDK, streaming response chunks, reusable templates). (7) **Design for now** (event-driven architecture, provider-agnostic prompting, composable MCP servers, cost as governance, portable agent configs as JSON Schema). (8) **Technical debt to leave behind** (prompt-level platform detection, manual session context, hardcoded model catalog, polling-based agent status, charter inlining at scale, regex decision parsing). (9) **SDK-native possibilities** (coordinator as executable code v0.7.0, tool namespacing declarative v0.6.0, cost governance enforced v0.7.0, skill plugins v0.8.0, portable squads composable v0.9.0, multi-repo squads v1.0.0). (10) **Universe selection: Coordinator Runtime Architect** â€” future role; current expert analysis is foundation for executable code coordinator built in v0.7.0+. (11) **10 lessons for future SDK expert** (event streams > docs, session-scoped thinking limiting, tool collision is load-bearing, MCP health is gap, fallback chains need manual error handling, version pinning non-paranoia, streaming not for everything, filesystem memory non-negotiable, latency under load is architecture choice, keep institutional knowledge fresh). OUTPUT: `.ai-team/docs/crossover-vision-kujan.md` (26KB knowledge transfer document).

- **2026-02-21: SDK Platform Constraint Analysis** â€” Brady asked: "Once we change, will users lose anything?" Analyzed SDK source, architecture, and decision records to identify hard platform limits. Key findings: (1) **Per-agent model selection is NOT possible in SDK** â€” sessions have a single model; CustomAgentConfig lacks model field. Squad's current per-agent model routing becomes impossible without building above SDK. (2) **Session-level initialization time** â€” SDK wraps Copilot CLI server startup, adding 1-3s overhead vs. instant CLI invocation, requiring async architecture throughout. (3) **Streaming is async-only** â€” SDK enforces event subscription pattern; Squad's current send-and-wait is possible via `sendAndWait()` but streaming requires subscription. (4) **Context window no longer a user concern** â€” infinite sessions with automatic background compaction at 80%, blocking at 95% eliminates Squad's manual overflow handling. (5) **SDK is Technical Preview (v0.1.x)** â€” breaking changes expected; adapter pattern + version pinning + weekly CI tests mitigation required. (6) **SDK adds ~2MB runtime weight** â€” bundled SDK is ~390KB alone, full orchestrator ~2-5MB, but only for `squad orchestrate` command. Scaffolding stays zero-dependency. (7) **Authentication flow changes** â€” SDK manages CLI auth automatically; no user-facing API key setup for Copilot users. BYOK users must configure provider at spawn time. (8) **Tool registration collision risk** â€” SDK has no per-agent tool scoping; multiple agents defining same tool name â†’ silent collision. Squad must build conflict detection + namespacing. OUTPUT: `.ai-team/agents/kujan/sdk-platform-analysis.md` (full report to Brady).

- **2026-02-10: Model Catalog (024a)** â€” Documented 16 models across 3 providers (Anthropic 6, OpenAI 9, Google 1), 3 tiers. OpenAI Codex strong for code tasks. Provider diversity = resilience play. 11-role mapping with defaults + specialists. Output: `team-docs/proposals/024a-model-catalog.md`.
- **2026-02-10: GitHub API Assessment (028a)** â€” MCP tools are read-only for Issues; all writes via `gh` CLI. Zero MCP tools for Projects V2. `task`/`general-purpose` agents have full access; `explore` has none. Projects blocked by missing `project` scope (`gh auth refresh -s project`). Rate limits generous (5K/hr REST+GraphQL). Output: `team-docs/proposals/028a-github-api-capabilities.md`.
- **2026-02-10: Async Comms Feasibility (030)** â€” CCA-as-squad-member is the breakthrough: `squad.agent.md` + CCA guidance = async work via Issues for 2-4h prompt engineering, zero infrastructure. Copilot SDK confirmed for Telegram bridge (8-16h, conditional on nested session spike). Ranking: CCA+Issues > Telegram > Discord > Discussions > Teams > Slack. Two-tier MVP: Tier 1 (CCA, guaranteed) + Tier 2 (Telegram, conditional). Output: `team-docs/proposals/030-async-comms-feasibility.md`.
- **2026-02-21: PRD Gap Audit â€” Feature Coverage Complete** â€” Brady identified 16 "None" PRDs in feature-comparison. Audit of PRDs 1-14 shows: 1 was mapping error (CLI-3 IS in PRD 14), 10 features ARE covered but implicit in existing PRDs and need section additions (STM-7/8/9/12, AGT-16, GH-3, DST-2/5/6/8), 5 features need entirely new PRDs (PRD 15 @copilot roster, PRD 16 export/import). All mappings updated in feature-comparison.md. PRD owners have clear spec additions for their PRDs. Brady decides PRD 15/16 scope/timeline. No GRAVE items remain unmapped.

ðŸ“Œ Team update (2026-02-10): v0.3.0 sprint plan approved â€” your model catalog research (024a) and GitHub API assessment (028a) are foundational inputs. â€” decided by Keaton


ðŸ“Œ Team update (2026-02-10): Async squad comms is #1 priority for 0.3.0 â€” update feasibility analysis â€” decided by bradygaster

ðŸ“Œ Team update (2026-02-10): Squad DM (Proposal 017) un-deferred to P0 â€” decided by bradygaster

- **2026-02-10: CCA E2E Test Design (031)** â€” `.ai-team/` is gitignored on main, so CCA cannot read `.ai-team/decisions.md`. All CCA governance must be self-contained within `.github/agents/squad.agent.md`. This fundamentally constrains the CCA-as-squad-member model: CCA follows `squad.agent.md` conventions, not the full Squad filesystem state. Proposal 030 Appendix A needs revision to account for this.
- **2026-02-10: CCA testability pattern** â€” Plant a convention in `squad.agent.md` that CCA would NOT do by default (e.g., "use `node:test`" instead of jest). If CCA follows it, strong signal it read the guidance. JSDoc alone is weak signal â€” CCA often adds it unprompted. Two-signal verification (JSDoc + node:test) gives high confidence.
- **2026-02-10: CCA E2E is observation-only** â€” CCA is a black box. Tests can only verify inputs (issue text, repo state) and outputs (branches, PRs, file diffs, CI status). No instrumentation possible. Structural checks (file exists, pattern present) over content checks (exact code match) for reliability against LLM non-determinism.
- **2026-02-10: Actions Automation Layer (032b)** â€” Designed 7 workflows automating the 032 proposal lifecycle: Proposal Lifecycle, Consensus Engine, Sprint Planner, Agent Comment Poster, Daily Standup, Stale Cleanup, CCA Dispatch. Key insight: Actions doesn't replace agents, it connects them â€” agents think, Actions plumbs. Phase 1 ships 3 workflows (lifecycle, consensus, stale cleanup) in 5-8h. `.ai-team/` gitignore constraint means Actions workflows operate entirely on GitHub API state (issues, labels, comments), not Squad filesystem state. CCA Dispatch deferred to Phase 2 pending 031 validation. Output: `team-docs/proposals/032b-actions-automation-layer.md`.
- **2026-02-10: Workflow distribution pattern** â€” Workflows ship as templates in `templates/workflows/`, installed opt-in during `squad init`. Not bundled in npm package (no convention for that). Users must audit and approve workflow installation. Standalone workflows for v0.3.0; reusable workflows / composite actions deferred.
- **2026-02-10: GitHub API state vs. filesystem state** â€” Actions and CCA both operate on GitHub API primitives (issues, labels, comments, PRs). Squad filesystem state (`.ai-team/`) is inaccessible to both because of the gitignore decision. This cleanly separates the automation layer (GitHub) from the agent memory layer (filesystem). No sync needed between them.
- **2026-02-10: Projects V2 API Assessment (033a)** â€” GitHub Projects V2 is fully feasible with zero npm dependencies using `gh project *` CLI commands exclusively. Zero MCP tools exist for Projects V2 (verified against all 17 MCP tools). GraphQL client proposed in Issue #6 is unnecessary â€” `gh` CLI wraps all GraphQL mutations. Only blocker: `project` token scope (same as 028a). Key insight: boards are visualization layer, labels remain the state machine (per `label-driven-workflow` skill anti-pattern). Provider abstraction maps cleanly: GitHub Projects V2 / ADO Boards / GitLab Issue Boards all reduce to prompt-level command templates. Recommend: implement as opt-in skill, not core code. Board operations should gracefully degrade when scope is missing. Output: `team-docs/proposals/033a-projects-v2-api-assessment.md`.


ðŸ“Œ Team update (2026-02-10): v0.3.0 is ONE feature â€” proposals as GitHub Issues. All other items deferred. â€” decided by bradygaster

ðŸ“Œ Team update (2026-02-10): Provider abstraction is prompt-level command templates, not JS interfaces. Platform section replaces Issue Source in team.md. â€” decided by Fenster, Keaton

ðŸ“Œ Team update (2026-02-10): Label taxonomy (39 labels, 7 namespaces) drives entire GitHub-native workflow. â€” decided by bradygaster, Verbal

ðŸ“Œ Team update (2026-02-10): Proposal migration uses three-wave approach â€” active first, shipped second, superseded/deferred last. â€” decided by Keaton


ðŸ“Œ Team update (2026-02-11): Project boards consolidated â€” v0.4.0 target confirmed, gh CLI (not npm), opt-in only, labels authoritative over boards. Community triage responses must use substantive technical detail. â€” decided by Keaton, Kujan

ðŸ“Œ Team update (2026-02-11): Per-agent model selection implemented with cost-first directive (optimize cost unless writing code) â€” decided by Brady and Verbal

ðŸ“Œ Team update (2026-02-11): Copilot client parity gap identified â€” Issue #10 filed as P1 tracking. Tool naming is API surface; CLI `task` vs VS Code `runSubagent`. Future work needs fallback strategies for non-CLI clients. â€” decided by Keaton

ðŸ“Œ Team update (2026-02-11): Discord is the v0.3.0 MVP messaging connector. Gateway must be platform-agnostic with zero GitHub-specific imports. â€” decided by Keaton

- **Issue #18: Version Display in Agent Output** â€” Investigated how to show Squad version across Copilot hosts. Key finding: the version stamping pipeline (`stampVersion()` in `index.js`) already embeds the version into `squad.agent.md` frontmatter during install/upgrade â€” the version was present but unused at runtime. Solution: added a `Version` instruction to the Coordinator Identity section telling the coordinator to read its own frontmatter version and include `Squad v{version}` in its first response. Zero `index.js` changes needed. Works across CLI, VS Code, and GitHub.com because it's coordinator behavior, not host-specific. The `description` frontmatter field and `task` tool `description` parameter were rejected as too noisy/per-spawn respectively.



ðŸ“Œ Team update (2026-02-12): Version display implemented via Coordinator self-announcement in squad.agent.md â€” leverages existing version stamping infrastructure â€” decided by Kujan

- **2026-02-13: CLI `task` vs VS Code `runSubagent` Spawn Parity (Issue #32, Proposal 032b)** â€” Complete analysis of how Squad's CLI-based spawn mechanism maps to VS Code's `runSubagent`. Key findings:
  - **Task tool parameter catalog:** 5 params â€” `prompt` (required), `agent_type` (required, Squad uses `general-purpose` 99%, `explore` 1%), `description` (required, format: `{Name}: {task}`), `mode` (`background` default, `sync` for gates), `model` (4-layer selection hierarchy with 3-tier fallback chains).
  - **Spawn pattern inventory:** 5 patterns â€” Standard (full ceremony), Lightweight (no charter/history), Explore (read-only, haiku), Scribe (always background, always haiku), Ceremony Facilitator (sync, spawns sub-agents).
  - **VS Code `runSubagent` surface:** prompt-only required param, sync-only (but parallel when multiple launched in one turn), model via custom `.agent.md` frontmatter (not per-spawn), no `agent_type` equivalent, no `description` param, no `mode` param.
  - **Parity gaps:** (1) No background mode â€” mitigated by parallel sync subagents achieving equivalent concurrency. (2) No per-spawn model selection â€” mitigated by accepting session model (v0.4.0) or generating custom agent files (v0.4.x). (3) No explore speed optimization â€” optional custom `explorer.agent.md`.
  - **Platform detection strategy:** Prompt-level conditional instructions in `squad.agent.md`. Coordinator checks which tool is available (`task` or `runSubagent`) and adapts. No abstraction layer needed.
  - **Decision:** No code-level abstraction layer. Prompt-level adaptation in `squad.agent.md` is sufficient. All 5 spawn patterns map successfully to VS Code.
  - **Output:** `team-docs/proposals/032b-cli-spawn-parity-analysis.md`

- **2026-02-14: Model Selection & Background Mode Parity (Issue #34, Proposal 034a)** â€” Deep dive on the two specific parity gaps Brady flagged: per-agent model selection and background/async execution. Key findings:
  - **Model selection:** `runSubagent` does NOT accept `model` param. Override via custom `.agent.md` frontmatter only. Supports prioritized fallback lists. Requires experimental `chat.customAgentInSubagent.enabled`. Three-phase approach: accept session model (v0.4.0) â†’ model-tier agent files (v0.5.0) â†’ per-role agent files (v0.6.0+).
  - **Background mode:** No equivalent. VS Code "Background Agents" are a different concept (CLI-based worktree sessions, user-initiated). Parallel sync subagents in one turn = equivalent concurrency. No fire-and-forget (Scribe blocks). No incremental collection (all-or-nothing).
  - **`agent` vs `runSubagent` tools:** `runSubagent` = anonymous subagent (session model). `agent` = named custom agent (frontmatter model). Squad should use `runSubagent` Phase 1, `agent` Phase 2.
  - **Result collection:** No `read_agent` equivalent needed â€” sync subagents return results automatically. Simpler on VS Code.
  - **Graceful degradation:** Accept session model when no custom agents. Skip launch table and read_agent on VS Code. Inline work when no spawn tool available.
  - **Output:** `team-docs/proposals/034a-model-background-parity.md`, commented on Issue #34.
ðŸ“Œ Team update (2026-02-14): VS Code Model & Background Parity â€” Phase 1 (v0.4.0): accept session model, use runSubagent. Phase 2 (v0.5.0): generate model-tier agent files. runSubagent lacks model param; use prompt-level detection in squad.agent.md. â€” decided by Kujan


ðŸ“Œ Team update (2026-02-15): Directory structure rename planned â€” .ai-team/ â†’ .squad/ starting v0.5.0 with backward-compatible migration; full removal in v1.0.0 â€” Brady

- **2026-02-16: CCA Compatibility Assessment (Issue #25)** â€” Researched whether Squad can run from Copilot Coding Agent. Verdict: **NO-GO for v0.5.0** pending empirical test of sub-agent spawning. Key findings:
  - **Custom agents (âœ…):** CCA reads `.github/agents/*.agent.md` like CLI â€” Squad governance loading is confirmed.
  - **Sub-agent spawning (âš ï¸ BLOCKER):** No documentation confirms `task` or equivalent tool availability in CCA environment. Squad's architecture requires spawning real sub-agents â€” without this, Squad cannot function as designed.
  - **Background mode (âŒ):** CCA likely doesn't support `mode: "background"` for fire-and-forget sub-agents. Could fall back to VS Code parallel sync pattern if spawning exists.
  - **MCP servers (âœ…):** CCA supports MCP including GitHub MCP server. Issue management feasible.
  - **File system (âš ï¸ CONSTRAINT):** `.ai-team/` is gitignored on main â€” CCA cannot read Squad memory (decisions, history, skills). All governance must be self-contained in `squad.agent.md`. CCA can write to `.ai-team/` and commit via PR.
  - **Session model (âœ…):** CCA's async batch execution (no user in loop) is compatible but eliminates interactive ceremonies requiring human gates.
  - **Complexity limits (âš ï¸):** CCA best for single-issue work; multi-agent sprints risky without confirmed sub-agent spawning.
  - **Recommended action:** Run empirical spike (2-4h) â€” test custom agent that attempts `task` tool call. If tool exists, proceed with CCA integration design. If not, select fallback: (A) CCA as Squad member, (B) lightweight single-agent mode, or (C) defer to v0.6.0.
  - Output: `.ai-team/decisions/inbox/kujan-cca-research.md`, comment on Issue #25


ðŸ“Œ Team update (2026-02-18): CCA Compatibility Assessment (Issue #25). Researched whether Squad can run from Copilot Coding Agent. Findings: custom agent files supported, MCP servers accessible, file system access constrained (.ai-team/ gitignored in CCA environment). CRITICAL BLOCKER: No confirmed sub-agent spawning mechanism (	ask tool availability unknown in CCA). NO-GO for v0.5.0 unless Phase 1 spike (2-4h) confirms 	ask tool. Recommended fallback: CCA as Squad member (not coordinator), or defer to v0.6.0. High architectural risk; empirical testing required. â€” decided by Kujan

- **2026-02-19: CCA Spike Test Plan (Issue #25)** â€” Wrote and posted a concrete, step-by-step spike test plan for empirically testing CCA capabilities. Four test vectors: (1) `task` tool availability for sub-agent spawning â€” the critical blocker, (2) `.ai-team/` file access on non-main branches (canary file with unique marker value), (3) MCP tools in practice (not just docs), (4) context window limits under `squad.agent.md` (~1,800 lines). Plan includes: custom probe agent file (`cca-probe.agent.md`), trigger issue template, observation matrix, combined go/no-go decision logic, and cleanup steps. Estimated ~1.5h wall clock including CCA wait time. Key insight: `.ai-team/` is NOT gitignored â€” it's blocked by a workflow guard on main/preview only, so CCA should see it on branches based on dev.

- **2026-02-19: Copilot SDK Comprehensive Analysis** â€” Exhaustively reviewed SDK for replatforming opportunity. Key findings:
  - **CustomAgents API designed for Squad's use case:** Register team members as named agents with charters as `prompt` field, per-agent MCP servers, tool access control. ~300 lines of spawn orchestration replaced with SDK config.
  - **Infinite sessions solve Proposal 007 context pressure:** Auto-compaction at 80% context, checkpoints for undo/replay, workspace persistence. Zero manual compaction code needed.
  - **Hooks system enables coordinator logic as code:** `onPreToolUse` for reviewer gates (no longer prompt adherence), `onPostToolUse` for result transformation, `onSessionStart` for context injection. Fragile prompt engineering replaced with hardened enforcement.
  - **SessionContext = worktree awareness:** SDK already tracks cwd, gitRoot, repository, branch per session. Squad's manual worktree detection (~50 lines) is unnecessary â€” SDK has it built-in.
  - **MCP per-agent config:** Backend Dev gets PostgreSQL MCP server, Frontend gets GitHub. Proposal 033a "provider abstraction is prompt-level command templates" was wrong â€” it's SDK MCP config.
  - **BYOK unlocks enterprise market:** Azure AI Foundry, OpenAI, Anthropic, Ollama support. Multi-provider fallback chains (Azure â†’ OpenAI â†’ Anthropic). Static token auth with `bearerToken` field.
  - **Event streams replace polling:** 40+ event types (tool.execution_start, assistant.message_delta, session.idle, session.compaction_complete). Real-time agent status without read_agent timeouts. Eliminates silent success bug (Proposal 015 P0).
  - **Model capabilities queryable:** `listModels()` returns vision support, reasoning effort support, context limits. Squad's hardcoded model list (Proposal 024a) becomes dynamic catalog.
  - **SDK maturity:** Protocol v2 (not v0.x), 18+ months production in Copilot CLI, 4 official language SDKs (TypeScript/Python/Go/.NET), comprehensive docs (getting-started, hooks, MCP, auth, skills, session persistence). "Technical Preview" disclaimer = breaking changes possible, but protocol stable enough for production use.
  - **Gaps identified:** Session locking (concurrent access undefined), per-agent hooks (session-scoped only, must route via sessionId lookup), model cost data (pricing not in SDK, need external data), MCP health monitoring (can't detect server failures proactively), BYOK auth limitations (no Entra ID, no managed identities, static tokens only).
  - **What Squad keeps:** Casting system (persistent names, universe allocation), filesystem memory (`.ai-team/` source of truth), coordinator orchestration logic (which agents, when, dependencies), decision governance (proposals, voting, lifecycle), Scribe pattern (dedicated documentation agent).
  - **Recommendation:** YES â€” replatform in two phases. Phase 1 (v0.6.0, 3-5 weeks): SDK as infrastructure, coordinator as agent.md, hybrid with custom tools (`squad_spawn_agent`). Phase 2 (v0.7.0, 8-12 weeks): coordinator as Node.js process using SDK client, full programmatic control. Adapter pattern required (SDK is preview, breaking changes expected). Migration path: dual-mode coordinator (SDK opt-in v0.6.0, default v0.7.0, only v1.0.0), zero downtime.
  - **Output:** `.ai-team/docs/sdk-opportunity-analysis.md` (61KB, exhaustive capability inventory + gap analysis + architecture + migration), `.ai-team/decisions/inbox/kujan-sdk-analysis.md` (decision record for Brady review).

- **2026-02-20: SDK Replatform PRDs (4 documents)** â€” Wrote four PRDs grounded in actual SDK source code review:
  - **PRD 6: Streaming Observability** â€” SDK has 30+ event types including `assistant.usage` with `cost` field (corrects earlier gap analysis that said SDK lacks cost data). `session.shutdown` event provides per-model `modelMetrics` with full token/cost breakdown. JSONL event logs + live CLI display + export format for external dashboards. Phase 2 (v0.7.0).
  - **PRD 9: BYOK & Multi-Provider** â€” SDK `ProviderConfig` supports `openai|azure|anthropic` types with `apiKey` or `bearerToken`. Provider config is per-session (no client-level default). Tier-based model aliases (`fast`/`standard`/`premium`) decouple charters from providers. Fallback chains with health caching. Phase 1 (v0.6.0).
  - **PRD 10: MCP Server Integration** â€” SDK `CustomAgentConfig.mcpServers` enables per-agent MCP routing natively. Squad as MCP server exposes roster/decisions/backlog as standard MCP resources. Tool filtering via `tools` array is include-list only (exclude must be resolved). Phase 1 per-agent config, Phase 2 Squad MCP server.
  - **PRD 12: Distribution & In-Copilot Install** â€” esbuild bundling with embedded templates via text loader. In-Copilot install via custom agent file (Phase 1), marketplace (Phase 2 when available). npm publishing as `@bradygaster/squad`. Auto-update check (24h cache, 3s timeout, silent fail). SDK as external dep (not bundled).
  - **Key SDK source findings during PRD writing:**
    - `assistant.usage` event includes `cost` field â€” SDK computes per-call cost. No external pricing data needed.
    - `session.shutdown` event has `modelMetrics` map with per-model request counts, costs, and token breakdowns.
    - `session.usage_info` provides `tokenLimit` and `currentTokens` for context pressure gauge.
    - `ProviderConfig.bearerToken` takes precedence over `apiKey` â€” useful for enterprise SSO tokens.
    - `MCPServerConfig.tools` is include-list only â€” SDK doesn't support exclude patterns.
    - `CustomAgentConfig.mcpServers` confirmed for per-agent MCP routing.
    - `SessionConfig.streaming` enables `assistant.message_delta` and `assistant.reasoning_delta` events.
  - **Output:** `.ai-team/docs/prds/06-streaming-observability.md`, `09-byok-multi-provider.md`, `10-mcp-server-integration.md`, `12-distribution-install.md`, `.ai-team/decisions/inbox/kujan-prd-platform.md`.

- **2026-02-21: Feature Comparison Document for SDK Replatform** â€” Exhaustive feature inventory of current Squad (62 features across 5 categories) mapped against SDK capabilities and 14 PRDs. Key findings: 18 GRAVE features with zero PRD coverage, 16 AT RISK with partial coverage, 28 fully covered. SDK enables 8 new capability categories. CustomAgentConfig is the natural mapping for Squad team members but lacks per-agent model field. Migration is 4 phases totaling 17â€“26 weeks. 6 blocking decisions pending from Brady. Output: `.ai-team/docs/feature-comparison.md`, `.ai-team/decisions/inbox/kujan-feature-comparison.md`.

ðŸ“Œ Team update (2026-02-21): Planning deliverables delivered â€” Kujan created feature-comparison.md with exhaustive feature inventory (62 features) mapped against SDK capabilities. Findings: 18 GRAVE (no PRD), 12 AT RISK, 28 COVERED, 5 INTENTIONAL. 8 new SDK capability categories identified. CustomAgentConfig as natural team member primitive. 4-phase migration 17â€“26 weeks. 6 blocking Brady decisions surfaced (package name, fallback chains, provider override, quota routing, OTLP export, PRD 16 scope). â€” Scribe

- **2026-02-21: SDK Import/Export Constraints Analysis** â€” Analyzed how Copilot SDK's session model, tool registration, authentication, and versioning interact with Squad's portable agent architecture. Key findings:
  - **Session model:** SDK sessions are ephemeral; squad state not serializable. `CustomAgentConfig` is portable but session state (learned preferences, conversation history) stays behind.
  - **Tool registration:** Session-scoped, not agent-scoped. No per-agent tool filtering in SDK. Squad must implement tool namespacing (`squad-{agent}:{tool}`) to prevent collisions.
  - **Authentication:** SDK handles OAuth priority well, but bulk imports hit GitHub API rate limits (5K/hr). Token expiry mid-import leaves partial state; Squad must validate pre-flight.
  - **MCP servers:** Config portable if environment-independent, but HTTP localhost URLs and embedded credentials are environment-specific. Squad must validate post-import.
  - **Versioning:** SDK has no schema versioning marker. Agent configs from SDK v0.1 may drop unknown fields in v0.2. Squad must track `sdk_version` in exports and implement schema adapters.
  - **Cross-platform:** Path separators and UTF-8 encoding need normalization; file size limits (>100KB prompts cause latency).
  - **Where SDK helps:** CustomAgentConfig format, hooks for tool validation, infinite sessions + compaction, auth abstraction, model capabilities query.
  - **Where Squad builds:** Import/export manifest format, tool conflict detection, MCP validation, version pinning, casting system, skill definitions, atomic import transactions.
  - **Customer risks:** Tool conflicts (silent wrong tool invocation), missing tools (runtime errors), MCP offline (graceful degradation needed), token expiry (rollback strategy), version mismatch (schema adapter).
  - Output: `.ai-team/docs/import-export-sdk-constraints.md` (7 sections, 9 recommendations, failure mode matrix)

ðŸ“Œ Team update (2026-02-21): PRD gap audit finalized â€” Kujan's 16 'None' item resolution merged to decisions.md. Audit findings: 1 mapping error (CLI-3 in PRD 14), 10 features need explicit PRD sections (STM-7/8/9/12 to PRD 14; AGT-16 to PRD 4; GH-3 to PRD 8; DST-2/5/6 to PRD 12), 5 need new PRDs (PRD 15 @copilot roster, PRD 16 export/import). Feature-comparison.md updated with all mappings. Deliverables in .ai-team/docs/prd-gap-resolutions.md. Awaiting Brady decision on PRD 15/16 scope and ownership. â€” decided by Kujan, merged by Scribe
